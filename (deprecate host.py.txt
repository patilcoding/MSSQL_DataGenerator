import os
import pyodbc

def load_credentials(file_path="credentials.txt"):
    """Read credentials from a text file and return them as a dictionary."""
    credentials = {}

    # Check if file exists
    if not os.path.exists(file_path):
        print(f"‚ùå Error: Credentials file not found at {file_path}")
        return None

    # Read credentials
    with open(file_path, "r") as f:
        for line in f:
            if "=" in line:
                key, value = line.strip().split("=", 1)
                credentials[key] = value

    print("üîπ Loaded Credentials:", credentials)  # Debugging: See what‚Äôs loaded
    return credentials

# Load credentials from file
creds = load_credentials()
if creds is None:
    exit("‚ö†Ô∏è Exiting: No credentials found!")

# Fetch values with error handling
DB_SERVER = creds.get("DB_SERVER")
DB_DATABASE = creds.get("DB_DATABASE")
DB_USERNAME = creds.get("DB_USERNAME")
DB_PASSWORD = creds.get("DB_PASSWORD")

# Check for missing credentials
if not all([DB_SERVER, DB_DATABASE, DB_USERNAME, DB_PASSWORD]):
    print("‚ùå Error: One or more credentials are missing in credentials.txt!")
    exit(1)

# Database connection
try:
    conn = pyodbc.connect(
        f"DRIVER={{ODBC Driver 17 for SQL Server}};"
        f"SERVER={DB_SERVER};"
        f"DATABASE={DB_DATABASE};"
        f"UID={DB_USERNAME};"
        f"PWD={DB_PASSWORD};"
    )
    conn.autocommit = True
    cursor = conn.cursor()
    print("‚úÖ Database connection successful!")
except Exception as e:
    print(f"‚ùå Error connecting to the database: {e}")
